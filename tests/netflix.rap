CREATE RELATION movies WITH COLUMNS (INTEGER, INTEGER),
CREATE RELATION ratings WITH COLUMNS (INTEGER, INTEGER, INTEGER),
SELECT [movies_0, movies_1] FROM (movies) WHERE [(movies_1 < 1970)] AS movies_sel,
(ratings) JOIN (movies_sel) ON ratings_0 AND movies_sel_0 AS rating_sel,
PROJECT [rating_sel_0, rating_sel_1, rating_sel_2] FROM (rating_sel) AS preferences,
PROJECT [preferences_1, preferences_0, preferences_2] FROM (preferences) AS transpose,
(preferences) JOIN (transpose) ON preferences_1 AND transpose_0 AS mat,
MUL [mat_2, mat_4] FROM (mat) AS matmult,
PROJECT [matmult_0, matmult_2, matmult_3] FROM (matmult) AS matmult_prj,
AGG [matmult_prj_1, +] FROM (matmult_prj) GROUP BY [matmult_prj_0, matmult_prj_2] AS int_result,
(int_result) JOIN (preferences) ON int_result_0 AND preferences_0 AS matfinal,
MUL [matfinal_2, matfinal_4] FROM (matfinal) AS matmultfinal,
PROJECT [matmultfinal_0, matmultfinal_2, matmultfinal_3] FROM (matmultfinal) AS matmultfinal_prj,
AGG [matmultfinal_prj_1, +] FROM (matmultfinal_prj) GROUP BY [matmultfinal_prj_0, matmultfinal_prj_2] AS predicted,
MAXIMUM [predicted_2] FROM (predicted) GROUP BY [predicted_1] AS prediction
